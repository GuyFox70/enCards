class Helper{static createElement(t){return document.createElement(t)}static getText(t){return t.innerHTML}static addText(t,e){t.innerHTML=e}static getInt(t){return parseInt(t)}static getFloat(t){return parseFloat(t)}static toJson(t){return JSON.stringify(t)}static fromJson(t){return JSON.parse(t)}static getSelector(t){return document.querySelector(t)}static getSelectorAll(t){return document.querySelectorAll(t)}static getAttr(t,e){return t.getAttribute(e)}static setAttr(t,e,r){t.setAttribute(e,r)}static rmAttr(t,e){t.removeAttribute(e)}static sendFetch(t,s){return new Promise((e,r)=>{fetch(t,s).then(t=>{if(t.ok)return t.json();r(new Error("Fetch is failed!"))}).then(t=>{t.state?e(t.data):r(new Error("Somethins wrong with response!"))}).catch(r)})}static setEvent(t,e,r){t.addEventListener(e,r)}static rmEvent(t,e,r){t.removeEventListener(e,r)}static addClass(e,t){Array.isArray(t)?t.forEach(t=>e.classList.add(t)):e.classList.add(t)}static rmClass(t,e){t.classList.remove(e)}static hasClass(t,e){return t.classList.contains(e)}}export default Helper;class Menu{#menuItem;#topBtMenu;#menu;#i;#partSpeech;#words;#limit;#skip;#studied;constructor(){this.#menuItem=Helper.getSelectorAll(".menu__item"),this.#topBtMenu=Helper.getSelector("#topBtMenu"),this.#menu=Helper.getSelector("#menu"),this.#partSpeech=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech"),this.#i=0,this.#words=Helper.fromJson(localStorage.getItem("words"))||null,this.#skip=Helper.getInt(localStorage.getItem("skip"))||0,this.#limit=Helper.getInt(localStorage.getItem("limit"))||100,this.#studied=Helper.fromJson(localStorage.getItem("studied"))||[]}#addEventItemsMenu(e,r){for(const t of this.#menuItem)Helper.setEvent(t,"click",()=>{this.#partSpeech!==Helper.getAttr(t,"data-partSpeech")&&(this.#menuItem.forEach(t=>Helper.rmClass(t,"activeTab")),Helper.addClass(t,"activeTab"),this.#partSpeech=Helper.getAttr(t,"data-partSpeech"),Helper.rmAttr(this.#menu,"style"),Helper.rmClass(this.#topBtMenu,"activeItem"),this.#i--,this.requestWordsFromDB().then(t=>{this.#words=t,e.resetCounter(),r.isCard(this,e)}).catch(t=>{console.log(t),alert(t.message)}))})}getSkip(){return this.#skip}getLimit(){return this.#limit}getPartSpeech(){return this.#partSpeech}getArrWords(){return this.#words}getStudiedWords(){return this.#studied}overwriteWords(t){this.#words=t}pushToStudied(t){this.#studied.push(this.#words[t])}requestWordsFromDB(){const r=new FormData;return r.set("skip",this.#skip),r.set("limit",this.#limit),r.set("partSpeech",this.#partSpeech),new Promise((t,e)=>{Helper.sendFetch("/getWords",{method:"POST",body:r}).then(t).catch(e)})}resetStudied(){this.#studied.length=0}setLimit(t){this.#limit=t}setSkip(t){this.#skip=t}setWords(t){this.#words=t}init(e,r){null===this.#words?this.requestWordsFromDB().then(t=>{this.#words=t,r.setWordToField(this.#words,this.#partSpeech,e.isEnglish())}).catch(t=>{console.log(t),alert(t.message)}):r.setWordToField(this.#words,this.#partSpeech,e.isEnglish()),this.#addEventItemsMenu(r,e),Helper.setEvent(this.#topBtMenu,"click",()=>{this.#i?(Helper.rmClass(this.#topBtMenu,"activeItem"),Helper.rmAttr(this.#menu,"style"),this.#i--):(Helper.addClass(this.#topBtMenu,"activeItem"),Helper.setAttr(this.#menu,"style","left: 0; transition: left .3s linear;"),this.#i++)})}}class Pages{#totalPage;#currentPage;#amountWords;constructor(){this.#totalPage=Helper.getSelector("#totalPage"),this.#currentPage=Helper.getSelector("#currentPage"),this.#amountWords={}}getAmountWords(){return this.#amountWords}calculateAmountPages(t,e){this.#setPagesField(Math.round(t/e))}getCurrentPageValue(){return Helper.getInt(Helper.getAttr(this.#currentPage,"data-page"))}getCurrentPageDOM(){return this.#currentPage}#getTotalPage(){return Helper.getInt(Helper.getAttr(this.#totalPage,"data-pages"))}#setPagesField(t){Helper.addText(this.#totalPage,t),Helper.setAttr(this.#totalPage,"data-pages",t)}queryAmountWords(e){const t=new FormData,r=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech");t.set("partSpeech",r),this.#amountWords[r]?this.calculateAmountPages(this.#amountWords[r],e):Helper.sendFetch("/getAmount",{method:"POST",body:t}).then(t=>{this.#amountWords[r]=t,this.calculateAmountPages(this.#amountWords[r],e)}).catch(t=>{this.#setPagesField(0),console.log(t),alert(t.message)})}#setCaretAtEnd(t){const e=document.getSelection();t=t.firstChild,e.collapse(t,t.length)}checkPage(t){var e=this.#getTotalPage(),t=t||this.getCurrentPageValue();e<t?(Helper.addText(this.#currentPage,e),Helper.setAttr(this.#currentPage,"data-page",e)):t<1?(Helper.addText(this.#currentPage,1),Helper.setAttr(this.#currentPage,"data-page",1)):(Helper.addText(this.#currentPage,t),Helper.setAttr(this.#currentPage,"data-page",t))}init(t,e,r,s,i){const l=()=>Helper.getInt(t.getCurrentPortion())*(this.getCurrentPageValue()-1);this.queryAmountWords(t.getCurrentPortion()),Helper.setEvent(this.#currentPage,"click",t=>{Helper.setAttr(t.target,"contenteditable",!0),t.target.focus()}),Helper.setEvent(this.#currentPage,"input",t=>{var t=t.target,e=Helper.getText(t),r=Helper.getInt(Helper.getText(this.#currentPage));if(isNaN(r)&&""!==e)return Helper.addText(t,1),void Helper.setAttr(t,"data-page",1);""!==e&&(this.checkPage(r),this.#setCaretAtEnd(this.#currentPage))}),Helper.setEvent(this.#currentPage,"blur",t=>{Helper.setAttr(t.target,"contenteditable",!1),e.setSkip(l()),i.call(null,e,r,s)}),Helper.setEvent(this.#currentPage,"keydown",t=>{13===t.keyCode&&(Helper.setAttr(t.target,"contenteditable",!1),e.setSkip(l()),i.call(null,e,r,s))})}}class PortionWords{#portionField;#nextPortion;#prevPortion;#step;#maxPortion;#minPortion;#currentPortion;constructor(){this.#portionField=Helper.getSelector("#portionField"),this.#nextPortion=Helper.getSelector("#nextPortion"),this.#prevPortion=Helper.getSelector("#prevPortion"),this.#step=10,this.#maxPortion=100,this.#minPortion=10,this.#currentPortion=Helper.getInt(localStorage.getItem("limit"))||this.#maxPortion}getCurrentPortion(){return this.#currentPortion}#checkPortion(t){t<=this.#minPortion?(this.#currentPortion=this.#minPortion,this.#prevPortion.disabled=!0):t>=this.#maxPortion?(this.#currentPortion=this.#maxPortion,this.#nextPortion.disabled=!0):(Helper.rmAttr(this.#prevPortion,"disabled"),Helper.rmAttr(this.#nextPortion,"disabled")),Helper.setAttr(this.#portionField,"data-value",this.#currentPortion),Helper.addText(this.#portionField,this.#currentPortion)}init(t,e,r,s,i){this.#checkPortion(this.#currentPortion),Helper.addText(this.#portionField,this.#currentPortion),Helper.setAttr(this.#portionField,"data-value",this.#currentPortion),Helper.setEvent(this.#nextPortion,"click",()=>{this.#currentPortion=this.#currentPortion+this.#step,this.#checkPortion(this.#currentPortion),s.calculateAmountPages(s.getAmountWords()[e.getPartSpeech()],this.#currentPortion),e.setSkip(0),s.checkPage(1),e.setLimit(this.#currentPortion),i.call(null,e,t,r)}),Helper.setEvent(this.#prevPortion,"click",()=>{this.#currentPortion=this.#currentPortion-this.#step,this.#checkPortion(this.#currentPortion),s.calculateAmountPages(s.getAmountWords()[e.getPartSpeech()],this.#currentPortion),e.setSkip(0),s.checkPage(1),e.setLimit(this.#currentPortion),i.call(null,e,t,r)})}}class Card{#flipCard;#flipCardInner;#mistakeReport;#btnsendReport;#btnCancelReport;#btnPrev;#btnStudied;#btnNext;#i;#j;#wordField;#translateField;constructor(){this.#flipCard=Helper.getSelector("#flipCard"),this.#mistakeReport=Helper.getSelector("#mistakeReport"),this.#btnsendReport=Helper.getSelector("#sendReport"),this.#btnCancelReport=Helper.getSelector("#cancelReport"),this.#btnPrev=Helper.getSelector("#prevWord"),this.#btnStudied=Helper.getSelector("#studied"),this.#btnNext=Helper.getSelector("#nextWord"),this.#wordField=Helper.getSelector("#wordField"),this.#translateField=Helper.getSelector("#translateField"),this.#flipCardInner=Helper.getSelector("#flipCardInner"),this.#i=0,this.#j=0}getFlipCard(){return this.#flipCard}getWordField(){return this.#wordField}getTranslateField(){return this.#translateField}resetCounter(){this.#i=0}setPage(t,e,r){return Helper.addText(t.getCurrentPageDOM(),r),Helper.setAttr(t.getCurrentPageDOM(),"data-page",r),t=r,Helper.getInt(e.getCurrentPortion())*(t-1)}setWordToField(t,e,r){setTimeout(()=>{null===t||0===t.length?(alert("Empty"),Helper.addText(this.#wordField,"-------"),Helper.addText(this.#translateField,"-------")):(Helper.addText(this.#wordField,r?t[this.#i].word:t[this.#i].translate[e].join(", ")),Helper.addText(this.#translateField,r?t[this.#i].translate[e].join(", "):t[this.#i].word))},0)}init(r,s,i,l,a){Helper.setEvent(this.#flipCard,"click",t=>{this.#j?(Helper.rmClass(this.#flipCardInner,"flip-card__inner-back"),this.#j--):(Helper.addClass(this.#flipCardInner,"flip-card__inner-back"),this.#j++)}),Helper.setEvent(this.#btnPrev,"click",t=>{t.stopPropagation(),this.#i--,this.#i<0&&(this.#i=r.getLimit()-1),this.setWordToField(r.getArrWords(),r.getPartSpeech(),s.isEnglish())}),Helper.setEvent(this.#btnStudied,"click",t=>{t.stopPropagation(),r.pushToStudied(this.#i);var t=r.getArrWords().filter((t,e)=>{if(e!==this.#i)return t}),e=t.length;this.#i>=e&&(this.#i=0===e?e:e-1),0===e?(confirm("Do you want to get the next portion of words?")?(e=this.setPage(l,i,l.getCurrentPageValue()+1),r.setSkip(e)):(e=this.setPage(l,i,l.getCurrentPageValue()),r.setSkip(e)),a.call(null,r,this,s),this.#btnStudied.length=0):(r.overwriteWords(t),this.setWordToField(r.getArrWords(),r.getPartSpeech(),s.isEnglish()))}),Helper.setEvent(this.#btnNext,"click",t=>{t.stopPropagation(),this.#i++,this.#i>=r.getLimit()&&(this.#i=0),this.setWordToField(r.getArrWords(),r.getPartSpeech(),s.isEnglish())})}}class TopButtons{#btnStudeid;TopButtons;#btnCard;#btnTable;#activeItem;#table;#tbody;#eng;#rus;#flagEng;#flagMode;constructor(){this.#eng=Helper.getSelector("#eng"),this.#rus=Helper.getSelector("#rus"),this.#btnStudeid=Helper.getSelector("#btnStudeid"),this.#btnCard=Helper.getSelector("#btnCard"),this.#btnTable=Helper.getSelector("#btnTable"),this.#activeItem=this.#btnCard,this.#table=Helper.getSelector("#table"),this.#tbody=Helper.getSelector("#table .table__tbody"),this.#flagEng=1,this.#flagMode=2}isEnglish(){return this.#flagEng}getMode(){return this.#flagMode}#rmActive(){Helper.rmClass(this.#activeItem,"activeItem")}createTable(e,r){if(Helper.addText(this.#tbody,""),null!==e&&0!==e.length){this.#rmActive(),Helper.addClass(this.#btnTable,"activeItem");for(let t=0;t<e.length;t++){const i=e[t],l=Helper.createElement("div");Helper.addClass(l,"table__tr");var s=Helper.createElement("td"),s=(Helper.addClass(s,["table__td","cell__number"]),Helper.addText(s,t+1),l.appendChild(s),Helper.createElement("td")),s=(Helper.addClass(s,["table__td","cell__word"]),Helper.addText(s,i.word),l.appendChild(s),Helper.createElement("td")),s=(Helper.addClass(s,["table__td","cell__transcription"]),Helper.addText(s,i.transcription),l.appendChild(s),Helper.createElement("td"));Helper.addClass(s,["table__td","cell__translate"]),Helper.addText(s,i.translate[r].join(", ")),l.appendChild(s),this.#tbody.appendChild(l)}this.#activeItem=this.#btnTable}}isCard(t,e){2===this.#flagMode?e.setWordToField(t.getArrWords(),t.getPartSpeech(),this.#flagEng):3===this.#flagMode&&this.createTable(t.getArrWords(),t.getPartSpeech())}#setActiveItem(t){this.#rmActive(),Helper.addClass(t,"activeItem"),this.#activeItem=t}#showHiddenElement(t,e){Helper.rmClass(t,"hidden"),Helper.addClass(e,"hidden")}init(e,r,s){Helper.setEvent(this.#eng,"click",t=>{2===this.#flagMode&&(this.#flagEng=1,this.isCard(e,r))}),Helper.setEvent(this.#rus,"click",t=>{2===this.#flagMode&&(this.#flagEng=0,this.isCard(e,r))}),Helper.setEvent(this.#btnStudeid,"click",t=>{1!==this.#flagMode&&(Helper.addClass(s,"hidden"),Helper.setAttr(this.#eng,"disabled",!0),Helper.setAttr(this.#rus,"disabled",!0),this.#setActiveItem(this.#btnStudeid),this.#showHiddenElement(this.#table,r.getFlipCard()),this.createTable(e.getStudiedWords(),e.getPartSpeech()),this.#flagMode=1)}),Helper.setEvent(this.#btnCard,"click",t=>{2!==this.#flagMode&&(Helper.addClass(s,"hidden"),Helper.rmAttr(this.#eng,"disabled"),Helper.rmAttr(this.#rus,"disabled"),this.#setActiveItem(this.#btnCard),r.resetCounter(),r.setWordToField(e.getArrWords(),e.getPartSpeech(),this.#flagEng),this.#showHiddenElement(r.getFlipCard(),this.#table),this.#flagMode=2)}),Helper.setEvent(this.#btnTable,"click",t=>{3!==this.#flagMode&&(Helper.rmClass(s,"hidden"),Helper.setAttr(this.#eng,"disabled",!0),Helper.setAttr(this.#rus,"disabled",!0),this.#setActiveItem(this.#btnTable),this.#showHiddenElement(this.#table,r.getFlipCard()),this.createTable(e.getArrWords(),e.getPartSpeech()),this.#flagMode=3)})}}class TableSettings{#tableSettings;#gearBox;constructor(){this.#tableSettings=Helper.getSelector("#tableSettings"),this.#gearBox=Helper.getSelector("#tableSettingsBox")}getTableSettingsTag(){return this.#tableSettings}init(){let e=0;Helper.setEvent(this.#tableSettings,"click",t=>{e?(Helper.rmClass(this.#gearBox,"tableSettingsBoxOpacity1"),Helper.addClass(this.#gearBox,"hide"),e--):(Helper.rmClass(this.#gearBox,"hide"),Helper.addClass(this.#gearBox,"tableSettingsBoxOpacity1"),e++)})}}document.addEventListener("DOMContentLoaded",()=>{try{var t=(e,r,s)=>{e.requestWordsFromDB().then(t=>{e.setWords(t),r.resetCounter(),s.isCard(e,r)}).catch(t=>{console.log(t),alert(t.message)})};const e=new Card,r=new Menu,s=new Pages,i=new PortionWords,l=new TopButtons,a=new TableSettings;r.init(l,e),s.init(i,r,e,l,t),i.init(e,r,l,s,t),e.init(r,l,i,s,t),l.init(r,e,a.getTableSettingsTag()),a.init()}catch(t){console.log(t),alert(t.message)}});