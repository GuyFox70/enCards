class Helper{static createElement(t){return document.createElement(t)}static getText(t){return t.innerHTML}static addText(t,e){t.innerHTML=e}static getInt(t){return parseInt(t)}static getFloat(t){return parseFloat(t)}static toJson(t){return JSON.stringify(t)}static fromJson(t){return JSON.parse(t)}static getSelector(t){return document.querySelector(t)}static getSelectorAll(t){return document.querySelectorAll(t)}static getAttr(t,e){return t.getAttribute(e)}static setAttr(t,e,r){t.setAttribute(e,r)}static rmAttr(t,e){t.removeAttribute(e)}static sendFetch(t,s){return new Promise((e,r)=>{fetch(t,s).then(t=>{if(t.ok)return t.json();r(new Error("Fetch is failed!"))}).then(t=>{t.state?e(t.data):r(new Error("Somethins wrong with response!"))}).catch(r)})}static setEvent(t,e,r){t.addEventListener(e,r)}static rmEvent(t,e,r){t.removeEventListener(e,r)}static addClass(e,t){Array.isArray(t)?t.forEach(t=>e.classList.add(t)):e.classList.add(t)}static rmClass(t,e){t.classList.remove(e)}static hasClass(t,e){return t.classList.contains(e)}}export default Helper;class Menu{#menuItem;#topBtMenu;#menu;#i;#partSpeech;#words;#limit;#skip;constructor(){this.#menuItem=Helper.getSelectorAll(".menu__item"),this.#topBtMenu=Helper.getSelector("#topBtMenu"),this.#menu=Helper.getSelector("#menu"),this.#partSpeech=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech"),this.#i=0,this.#words=Helper.fromJson(localStorage.getItem("words"))||null,this.#skip=Helper.getInt(localStorage.getItem("skip"))||0,this.#limit=Helper.getInt(localStorage.getItem("limit"))||100}getSkip(){return this.#skip}getLimit(){return this.#limit}getPartSpeech(){return this.#partSpeech}getWords(){return this.#words}setLimit(t){this.#limit=t}setSkip(t){this.#skip=t}setWords(t){this.#words=t}requestWordsFromDB(){const r=new FormData;return r.set("skip",this.#skip),r.set("limit",this.#limit),r.set("partSpeech",this.#partSpeech),new Promise((t,e)=>{Helper.sendFetch("/getWords",{method:"POST",body:r}).then(t).catch(e)})}#addEventItemsMenu(e){for(const t of this.#menuItem)Helper.setEvent(t,"click",()=>{this.#partSpeech!==Helper.getAttr(t,"data-partSpeech")&&(this.#menuItem.forEach(t=>Helper.rmClass(t,"activeTab")),Helper.addClass(t,"activeTab"),this.#partSpeech=Helper.getAttr(t,"data-partSpeech"),Helper.rmAttr(this.#menu,"style"),Helper.rmClass(this.#topBtMenu,"activeItem"),this.#i--,this.requestWordsFromDB().then(t=>{this.#words=t,e.resetCounter(),e.setWordToField(this.#words,this.#partSpeech)}).catch(t=>{console.log(t),alert(t.message)}))})}init(e,r){null===this.#words?this.requestWordsFromDB().then(t=>{this.#words=t,r.setWordToField(this.#words,this.#partSpeech,e.isEnglish())}).catch(t=>{console.log(t),alert(t.message)}):r.setWordToField(this.#words,this.#partSpeech,e.isEnglish()),this.#addEventItemsMenu(r),Helper.setEvent(this.#topBtMenu,"click",()=>{this.#i?(Helper.rmClass(this.#topBtMenu,"activeItem"),Helper.rmAttr(this.#menu,"style"),this.#i--):(Helper.addClass(this.#topBtMenu,"activeItem"),Helper.setAttr(this.#menu,"style","left: 0; transition: left .3s linear;"),this.#i++)})}}class Pages{#totalPage;#currentPage;#amountWords;constructor(){this.#totalPage=Helper.getSelector("#totalPage"),this.#currentPage=Helper.getSelector("#currentPage"),this.#amountWords={}}getAmountWords(){return this.#amountWords}calculateAmountPages(t,e){this.#setPagesField(Math.round(t/e))}#getCurrentPage(){return Helper.getInt(Helper.getAttr(this.#currentPage,"data-page"))}#getTotalPage(){return Helper.getInt(Helper.getAttr(this.#totalPage,"data-pages"))}#setPagesField(t){Helper.addText(this.#totalPage,t),Helper.setAttr(this.#totalPage,"data-pages",t)}queryAmountWords(e){const t=new FormData,r=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech");t.set("partSpeech",r),this.#amountWords[r]?this.calculateAmountPages(this.#amountWords[r],e):Helper.sendFetch("/getAmount",{method:"POST",body:t}).then(t=>{this.#amountWords[r]=t,this.calculateAmountPages(this.#amountWords[r],e)}).catch(t=>{this.#setPagesField(0),console.log(t),alert(t.message)})}#setCaretAtEnd(t){const e=document.getSelection();t=t.firstChild,e.collapse(t,t.length)}checkPage(t){var e=this.#getTotalPage(),t=t||this.#getCurrentPage();e<t?(Helper.addText(this.#currentPage,e),Helper.setAttr(this.#currentPage,"data-page",e)):t<1?(Helper.addText(this.#currentPage,1),Helper.setAttr(this.#currentPage,"data-page",1)):(Helper.addText(this.#currentPage,t),Helper.setAttr(this.#currentPage,"data-page",t))}init(r,s,i,a){this.queryAmountWords(r.getCurrentPortion()),Helper.setEvent(this.#currentPage,"click",t=>{Helper.setAttr(t.target,"contenteditable",!0),t.target.focus()}),Helper.setEvent(this.#currentPage,"input",t=>{var t=t.target,e=Helper.getText(t),r=Helper.getInt(Helper.getText(this.#currentPage));if(isNaN(r)&&""!==e)return Helper.addText(t,1),void Helper.setAttr(t,"data-page",1);""!==e&&(this.checkPage(r),this.#setCaretAtEnd(this.#currentPage))}),Helper.setEvent(this.#currentPage,"blur",t=>{var e=this.#getCurrentPage()-1,e=Helper.getInt(r.getCurrentPortion())*e;s.setSkip(e),s.requestWordsFromDB().then(t=>{s.setWords(t),i.resetCounter(),i.isCard(s,a)}).catch(t=>{console.log(t),alert(t.message)})})}}class ProtionWords{#portionField;#nextPortion;#prevPortion;#step;#maxPortion;#minPortion;#currentPortion;constructor(){this.#portionField=Helper.getSelector("#portionField"),this.#nextPortion=Helper.getSelector("#nextPortion"),this.#prevPortion=Helper.getSelector("#prevPortion"),this.#step=10,this.#maxPortion=100,this.#minPortion=10,this.#currentPortion=Helper.getInt(localStorage.getItem("limit"))||this.#maxPortion}getCurrentPortion(){return this.#currentPortion}#checkPortion(t){t<=this.#minPortion?(this.#currentPortion=this.#minPortion,this.#prevPortion.disabled=!0):t>=this.#maxPortion?(this.#currentPortion=this.#maxPortion,this.#nextPortion.disabled=!0):(Helper.rmAttr(this.#prevPortion,"disabled"),Helper.rmAttr(this.#nextPortion,"disabled")),Helper.setAttr(this.#portionField,"data-value",this.#currentPortion),Helper.addText(this.#portionField,this.#currentPortion)}init(e,r,s,t){this.#checkPortion(this.#currentPortion),Helper.addText(this.#portionField,this.#currentPortion),Helper.setAttr(this.#portionField,"data-value",this.#currentPortion),Helper.setEvent(this.#nextPortion,"click",()=>{this.#currentPortion=this.#currentPortion+this.#step,this.#checkPortion(this.#currentPortion),t.calculateAmountPages(t.getAmountWords()[r.getPartSpeech()],this.#currentPortion),r.setSkip(0),t.checkPage(1),r.setLimit(this.#currentPortion),r.requestWordsFromDB().then(t=>{r.setWords(t),e.resetCounter(),e.isCard(r,s,s.isEnglish())}).catch(t=>{console.log(t),alert(t.message)})}),Helper.setEvent(this.#prevPortion,"click",()=>{this.#currentPortion=this.#currentPortion-this.#step,this.#checkPortion(this.#currentPortion),t.calculateAmountPages(t.getAmountWords()[r.getPartSpeech()],this.#currentPortion),r.setSkip(0),t.checkPage(1),r.setLimit(this.#currentPortion),r.requestWordsFromDB().then(t=>{r.setWords(t),e.resetCounter(),e.isCard(r,s,s.isEnglish())}).catch(t=>{console.log(t),alert(t.message)})})}}class Card{#flipCard;#flipCardInner;#mistakeReport;#btnsendReport;#btnCancelReport;#btnPrev;#btnStudied;#btnNext;#i;#j;#wordField;#translateField;constructor(){this.#flipCard=Helper.getSelector("#flipCard"),this.#mistakeReport=Helper.getSelector("#mistakeReport"),this.#btnsendReport=Helper.getSelector("#sendReport"),this.#btnCancelReport=Helper.getSelector("#cancelReport"),this.#btnPrev=Helper.getSelector("#prevWord"),this.#btnStudied=Helper.getSelector("#studied"),this.#btnNext=Helper.getSelector("#nextWord"),this.#wordField=Helper.getSelector("#wordField"),this.#translateField=Helper.getSelector("#translateField"),this.#flipCardInner=Helper.getSelector("#flipCardInner"),this.#i=0,this.#j=0}getFlipCard(){return this.#flipCard}getWordField(){return this.#wordField}getTranslateField(){return this.#translateField}resetCounter(){this.#i=0}setWordToField(t,e,r){setTimeout(()=>{null===t||0===t.length?(alert("Empty"),Helper.addText(this.#wordField,"-------"),Helper.addText(this.#translateField,"-------")):(Helper.addText(this.#wordField,r?t[this.#i].word:t[this.#i].translate[e].join(", ")),Helper.addText(this.#translateField,r?t[this.#i].translate[e].join(", "):t[this.#i].word))},0)}isCard(t,e,r){Helper.hasClass(this.#flipCard,"hidden")?e.createTable(t.getWords(),t.getPartSpeech()):this.setWordToField(t.getWords(),t.getPartSpeech(),r)}init(e,r){Helper.setEvent(this.#flipCard,"click",t=>{this.#j?(Helper.rmClass(this.#flipCardInner,"flip-card__inner-back"),this.#j--):(Helper.addClass(this.#flipCardInner,"flip-card__inner-back"),this.#j++)}),Helper.setEvent(this.#btnPrev,"click",t=>{t.stopPropagation(),this.#i--,this.#i<0&&(this.#i=e.getLimit()-1),this.setWordToField(e.getWords(),e.getPartSpeech(),r.isEnglish())}),Helper.setEvent(this.#btnStudied,"click",t=>{t.stopPropagation(),console.log("push")}),Helper.setEvent(this.#btnNext,"click",t=>{t.stopPropagation(),this.#i++,this.#i>=e.getLimit()&&(this.#i=0),this.setWordToField(e.getWords(),e.getPartSpeech(),r.isEnglish())})}}class TopButtons{#btnStudeid;TopButtons;#btnCard;#btnTable;#activeItem;#table;#tbody;#eng;#rus;#flagEng;constructor(){this.#eng=Helper.getSelector("#eng"),this.#rus=Helper.getSelector("#rus"),this.#btnStudeid=Helper.getSelector("#btnStudeid"),this.#btnCard=Helper.getSelector("#btnCard"),this.#btnTable=Helper.getSelector("#btnTable"),this.#activeItem=this.#btnCard,this.#table=Helper.getSelector("#table"),this.#tbody=Helper.getSelector("#table .table__tbody"),this.#flagEng=1}isEnglish(){return this.#flagEng}#rmActive(){Helper.rmClass(this.#activeItem,"activeItem")}createTable(e,r){if(Helper.addText(this.#tbody,""),null!==e&&0!==e.length&&!Helper.hasClass(this.#table,"hidden")){this.#rmActive(),Helper.addClass(this.#btnTable,"activeItem");for(let t=0;t<e.length;t++){const i=e[t],a=Helper.createElement("div");Helper.addClass(a,"table__tr");var s=Helper.createElement("td"),s=(Helper.addClass(s,["table__td","cell__number"]),Helper.addText(s,t+1),a.appendChild(s),Helper.createElement("td")),s=(Helper.addClass(s,["table__td","cell__word"]),Helper.addText(s,i.word),a.appendChild(s),Helper.createElement("td")),s=(Helper.addClass(s,["table__td","cell__transcription"]),Helper.addText(s,i.transcription),a.appendChild(s),Helper.createElement("td"));Helper.addClass(s,["table__td","cell__translate"]),Helper.addText(s,i.translate[r].join(", ")),a.appendChild(s),this.#tbody.appendChild(a)}this.#activeItem=this.#btnTable}}init(e,r){Helper.setEvent(this.#eng,"click",t=>{this.#flagEng=1,r.isCard(e,this,this.#flagEng)}),Helper.setEvent(this.#rus,"click",t=>{this.#flagEng=0,r.isCard(e,this,this.#flagEng)}),Helper.setEvent(this.#btnStudeid,"click",t=>{Helper.hasClass(this.#btnStudeid,"activeItem")||(this.#rmActive(),Helper.addClass(this.#btnStudeid,"activeItem"),this.#activeItem=this.#btnStudeid)}),Helper.setEvent(this.#btnCard,"click",t=>{Helper.hasClass(this.#btnCard,"activeItem")||(this.#rmActive(),Helper.addClass(this.#btnCard,"activeItem"),r.resetCounter(),r.setWordToField(e.getWords(),e.getPartSpeech()),Helper.addClass(this.#table,"hidden"),Helper.rmClass(r.getFlipCard(),"hidden"),this.#activeItem=this.#btnCard)}),Helper.setEvent(this.#btnTable,"click",t=>{Helper.hasClass(this.#btnTable,"activeItem")||(Helper.addClass(r.getFlipCard(),"hidden"),Helper.rmClass(this.#table,"hidden"),this.createTable(e.getWords(),e.getPartSpeech()))})}}document.addEventListener("DOMContentLoaded",()=>{try{const t=new Card,e=new Menu,r=new Pages,s=new ProtionWords,i=new TopButtons;e.init(i,t),r.init(s,e,t,i),s.init(t,e,i,r),t.init(e,i),i.init(e,t)}catch(t){console.log(t),alert(t.message)}});