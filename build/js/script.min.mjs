class Helper{static createElement(e){return document.createElement(e)}static getText(e){return e.innerHTML}static addText(e,t){e.innerHTML=t}static getInt(e){return parseInt(e)}static getFloat(e){return parseFloat(e)}static toJson(e){return JSON.stringify(e)}static fromJson(e){return JSON.parse(e)}static getSelector(e){return document.querySelector(e)}static getSelectorAll(e){return document.querySelectorAll(e)}static getAttr(e,t){return e.getAttribute(t)}static setAttr(e,t,r){e.setAttribute(t,r)}static rmAttr(e,t){e.removeAttribute(t)}static sendFetch(e,s){return new Promise((t,r)=>{fetch(e,s).then(e=>{if(e.ok)return e.json();r(new Error("Fetch is failed!"))}).then(e=>{e.state?t(e.data):r(new Error("Somethins wrong with response!"))}).catch(r)})}static setEvent(e,t,r){e.addEventListener(t,r)}static rmEvent(e,t,r){e.removeEventListener(t,r)}static addClass(t,e){Array.isArray(e)?e.forEach(e=>t.classList.add(e)):t.classList.add(e)}static rmClass(e,t){e.classList.remove(t)}static hasClass(e,t){return e.classList.contains(t)}}export default Helper;class Menu{#menuItem;#topBtMenu;#menu;#i;#partSpeech;#words;#limit;#skip;#studied;constructor(){this.#menuItem=Helper.getSelectorAll(".menu__item"),this.#topBtMenu=Helper.getSelector("#topBtMenu"),this.#menu=Helper.getSelector("#menu"),this.#partSpeech=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech"),this.#i=0,this.#words=Helper.fromJson(localStorage.getItem("words"))||null,this.#skip=Helper.getInt(localStorage.getItem("skip"))||0,this.#limit=Helper.getInt(localStorage.getItem("limit"))||100,this.#studied=Helper.fromJson(localStorage.getItem("studied"))||[]}#addEventItemsMenu(t,r){for(const e of this.#menuItem)Helper.setEvent(e,"click",()=>{this.#partSpeech!==Helper.getAttr(e,"data-partSpeech")&&(this.#menuItem.forEach(e=>Helper.rmClass(e,"activeTab")),Helper.addClass(e,"activeTab"),this.#partSpeech=Helper.getAttr(e,"data-partSpeech"),Helper.rmAttr(this.#menu,"style"),Helper.rmClass(this.#topBtMenu,"activeItem"),this.#i--,this.requestWordsFromDB().then(e=>{this.#words=e,t.resetCounter(),r.isCard(this,t)}).catch(e=>{console.log(e),alert(e.message)}))})}getSkip(){return this.#skip}getLimit(){return this.#limit}getPartSpeech(){return this.#partSpeech}getArrWords(){return this.#words}getStudiedWords(){return this.#studied}overwriteWords(e){this.#words=e}pushToStudied(e){this.#studied.push(this.#words[e])}requestWordsFromDB(){const r=new FormData;return r.set("skip",this.#skip),r.set("limit",this.#limit),r.set("partSpeech",this.#partSpeech),new Promise((e,t)=>{Helper.sendFetch("/getWords",{method:"POST",body:r}).then(e).catch(t)})}resetStudied(){this.#studied.length=0}setLimit(e){this.#limit=e}setSkip(e){this.#skip=e}setWords(e){this.#words=e}init(t,r){null===this.#words?this.requestWordsFromDB().then(e=>{this.#words=e,r.setWordToField(this.#words,this.#partSpeech,t.isEnglish())}).catch(e=>{console.log(e),alert(e.message)}):r.setWordToField(this.#words,this.#partSpeech,t.isEnglish()),this.#addEventItemsMenu(r,t),Helper.setEvent(this.#topBtMenu,"click",()=>{this.#i?(Helper.rmClass(this.#topBtMenu,"activeItem"),Helper.rmAttr(this.#menu,"style"),this.#i--):(Helper.addClass(this.#topBtMenu,"activeItem"),Helper.setAttr(this.#menu,"style","left: 0; transition: left .3s linear;"),this.#i++)})}}class Pages{#totalPage;#currentPage;#amountWords;constructor(){this.#totalPage=Helper.getSelector("#totalPage"),this.#currentPage=Helper.getSelector("#currentPage"),this.#amountWords={}}getAmountWords(){return this.#amountWords}calculateAmountPages(e,t){this.#setPagesField(Math.round(e/t))}getCurrentPageValue(){return Helper.getInt(Helper.getAttr(this.#currentPage,"data-page"))}getCurrentPageDOM(){return this.#currentPage}#getTotalPage(){return Helper.getInt(Helper.getAttr(this.#totalPage,"data-pages"))}#setPagesField(e){Helper.addText(this.#totalPage,e),Helper.setAttr(this.#totalPage,"data-pages",e)}queryAmountWords(t){const e=new FormData,r=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech");e.set("partSpeech",r),this.#amountWords[r]?this.calculateAmountPages(this.#amountWords[r],t):Helper.sendFetch("/getAmount",{method:"POST",body:e}).then(e=>{this.#amountWords[r]=e,this.calculateAmountPages(this.#amountWords[r],t)}).catch(e=>{this.#setPagesField(0),console.log(e),alert(e.message)})}#setCaretAtEnd(e){const t=document.getSelection();e=e.firstChild,t.collapse(e,e.length)}checkPage(e){var t=this.#getTotalPage(),e=e||this.getCurrentPageValue();t<e?(Helper.addText(this.#currentPage,t),Helper.setAttr(this.#currentPage,"data-page",t)):e<1?(Helper.addText(this.#currentPage,1),Helper.setAttr(this.#currentPage,"data-page",1)):(Helper.addText(this.#currentPage,e),Helper.setAttr(this.#currentPage,"data-page",e))}init(e,t,r,s,i){const l=()=>Helper.getInt(e.getCurrentPortion())*(this.getCurrentPageValue()-1);this.queryAmountWords(e.getCurrentPortion()),Helper.setEvent(this.#currentPage,"click",e=>{Helper.setAttr(e.target,"contenteditable",!0),e.target.focus()}),Helper.setEvent(this.#currentPage,"input",e=>{var e=e.target,t=Helper.getText(e),r=Helper.getInt(Helper.getText(this.#currentPage));if(isNaN(r)&&""!==t)return Helper.addText(e,1),void Helper.setAttr(e,"data-page",1);""!==t&&(this.checkPage(r),this.#setCaretAtEnd(this.#currentPage))}),Helper.setEvent(this.#currentPage,"blur",e=>{Helper.setAttr(e.target,"contenteditable",!1),t.setSkip(l()),i.call(null,t,r,s)}),Helper.setEvent(this.#currentPage,"keydown",e=>{13===e.keyCode&&(Helper.setAttr(e.target,"contenteditable",!1),t.setSkip(l()),i.call(null,t,r,s))})}}class PortionWords{#portionField;#nextPortion;#prevPortion;#step;#maxPortion;#minPortion;#currentPortion;constructor(){this.#portionField=Helper.getSelector("#portionField"),this.#nextPortion=Helper.getSelector("#nextPortion"),this.#prevPortion=Helper.getSelector("#prevPortion"),this.#step=10,this.#maxPortion=100,this.#minPortion=10,this.#currentPortion=Helper.getInt(localStorage.getItem("limit"))||this.#maxPortion}getCurrentPortion(){return this.#currentPortion}#checkPortion(e){e<=this.#minPortion?(this.#currentPortion=this.#minPortion,this.#prevPortion.disabled=!0):e>=this.#maxPortion?(this.#currentPortion=this.#maxPortion,this.#nextPortion.disabled=!0):(Helper.rmAttr(this.#prevPortion,"disabled"),Helper.rmAttr(this.#nextPortion,"disabled")),Helper.setAttr(this.#portionField,"data-value",this.#currentPortion),Helper.addText(this.#portionField,this.#currentPortion)}init(e,t,r,s,i){this.#checkPortion(this.#currentPortion),Helper.addText(this.#portionField,this.#currentPortion),Helper.setAttr(this.#portionField,"data-value",this.#currentPortion),Helper.setEvent(this.#nextPortion,"click",()=>{this.#currentPortion=this.#currentPortion+this.#step,this.#checkPortion(this.#currentPortion),s.calculateAmountPages(s.getAmountWords()[t.getPartSpeech()],this.#currentPortion),t.setSkip(0),s.checkPage(1),t.setLimit(this.#currentPortion),i.call(null,t,e,r)}),Helper.setEvent(this.#prevPortion,"click",()=>{this.#currentPortion=this.#currentPortion-this.#step,this.#checkPortion(this.#currentPortion),s.calculateAmountPages(s.getAmountWords()[t.getPartSpeech()],this.#currentPortion),t.setSkip(0),s.checkPage(1),t.setLimit(this.#currentPortion),i.call(null,t,e,r)})}}class Card{#flipCard;#flipCardInner;#mistakeReport;#btnsendReport;#btnCancelReport;#btnPrev;#btnStudied;#btnNext;#i;#j;#wordField;#translateField;constructor(){this.#flipCard=Helper.getSelector("#flipCard"),this.#mistakeReport=Helper.getSelector("#mistakeReport"),this.#btnsendReport=Helper.getSelector("#sendReport"),this.#btnCancelReport=Helper.getSelector("#cancelReport"),this.#btnPrev=Helper.getSelector("#prevWord"),this.#btnStudied=Helper.getSelector("#studied"),this.#btnNext=Helper.getSelector("#nextWord"),this.#wordField=Helper.getSelector("#wordField"),this.#translateField=Helper.getSelector("#translateField"),this.#flipCardInner=Helper.getSelector("#flipCardInner"),this.#i=0,this.#j=0}getFlipCard(){return this.#flipCard}getWordField(){return this.#wordField}getTranslateField(){return this.#translateField}resetCounter(){this.#i=0}setPage(e,t,r){return Helper.addText(e.getCurrentPageDOM(),r),Helper.setAttr(e.getCurrentPageDOM(),"data-page",r),e=r,Helper.getInt(t.getCurrentPortion())*(e-1)}setWordToField(e,t,r){setTimeout(()=>{null===e||0===e.length?(alert("Empty"),Helper.addText(this.#wordField,"-------"),Helper.addText(this.#translateField,"-------")):(Helper.addText(this.#wordField,r?e[this.#i].word:e[this.#i].translate[t].join(", ")),Helper.addText(this.#translateField,r?e[this.#i].translate[t].join(", "):e[this.#i].word))},0)}init(r,s,i,l,a){Helper.setEvent(this.#flipCard,"click",e=>{this.#j?(Helper.rmClass(this.#flipCardInner,"flip-card__inner-back"),this.#j--):(Helper.addClass(this.#flipCardInner,"flip-card__inner-back"),this.#j++)}),Helper.setEvent(this.#btnPrev,"click",e=>{e.stopPropagation(),this.#i--,this.#i<0&&(this.#i=r.getLimit()-1),this.setWordToField(r.getArrWords(),r.getPartSpeech(),s.isEnglish())}),Helper.setEvent(this.#btnStudied,"click",e=>{e.stopPropagation(),r.pushToStudied(this.#i);var e=r.getArrWords().filter((e,t)=>{if(t!==this.#i)return e}),t=e.length;this.#i>=t&&(this.#i=0===t?t:t-1),0===t?(confirm("Do you want to get the next portion of words?")?(t=this.setPage(l,i,l.getCurrentPageValue()+1),r.setSkip(t)):(t=this.setPage(l,i,l.getCurrentPageValue()),r.setSkip(t)),a.call(null,r,this,s),this.#btnStudied.length=0):(r.overwriteWords(e),this.setWordToField(r.getArrWords(),r.getPartSpeech(),s.isEnglish()))}),Helper.setEvent(this.#btnNext,"click",e=>{e.stopPropagation(),this.#i++,this.#i>=r.getLimit()&&(this.#i=0),this.setWordToField(r.getArrWords(),r.getPartSpeech(),s.isEnglish())})}}class TopButtons{#btnStudeid;TopButtons;#btnCard;#btnTable;#activeItem;#table;#tbody;#eng;#rus;#flagEng;#flagMode;constructor(){this.#eng=Helper.getSelector("#eng"),this.#rus=Helper.getSelector("#rus"),this.#btnStudeid=Helper.getSelector("#btnStudeid"),this.#btnCard=Helper.getSelector("#btnCard"),this.#btnTable=Helper.getSelector("#btnTable"),this.#activeItem=this.#btnCard,this.#table=Helper.getSelector("#table"),this.#tbody=Helper.getSelector("#table .table__tbody"),this.#flagEng=1,this.#flagMode=2}isEnglish(){return this.#flagEng}getMode(){return this.#flagMode}#rmActive(){Helper.rmClass(this.#activeItem,"activeItem")}createTable(t,r){if(Helper.addText(this.#tbody,""),null!==t&&0!==t.length){this.#rmActive(),Helper.addClass(this.#btnTable,"activeItem");for(let e=0;e<t.length;e++){const i=t[e],l=Helper.createElement("div");Helper.addClass(l,"table__tr");var s=Helper.createElement("td"),s=(Helper.addClass(s,["table__td","cell__number"]),Helper.addText(s,e+1),l.appendChild(s),Helper.createElement("td")),s=(Helper.addClass(s,["table__td","cell__word"]),Helper.addText(s,i.word),l.appendChild(s),Helper.createElement("td")),s=(Helper.addClass(s,["table__td","cell__transcription"]),Helper.addText(s,i.transcription),l.appendChild(s),Helper.createElement("td"));Helper.addClass(s,["table__td","cell__translate"]),Helper.addText(s,i.translate[r].join(", ")),l.appendChild(s),this.#tbody.appendChild(l)}this.#activeItem=this.#btnTable}}isCard(e,t){2===this.#flagMode?t.setWordToField(e.getArrWords(),e.getPartSpeech(),this.#flagEng):3===this.#flagMode&&this.createTable(e.getArrWords(),e.getPartSpeech())}#setActiveItem(e){this.#rmActive(),Helper.addClass(e,"activeItem"),this.#activeItem=e}#showHiddenElement(e,t){Helper.rmClass(e,"hidden"),Helper.addClass(t,"hidden")}init(t,r,s){Helper.setEvent(this.#eng,"click",e=>{2===this.#flagMode&&(this.#flagEng=1,this.isCard(t,r))}),Helper.setEvent(this.#rus,"click",e=>{2===this.#flagMode&&(this.#flagEng=0,this.isCard(t,r))}),Helper.setEvent(this.#btnStudeid,"click",e=>{1!==this.#flagMode&&(Helper.rmClass(s.getTableSettingsImgTag(),"rotate60"),Helper.addClass(s.getGearBox(),"hide"),s.resetCounter(),s.setChecked(),Helper.addClass(s.getTableSettingsTag(),"hidden"),Helper.setAttr(this.#eng,"disabled",!0),Helper.setAttr(this.#rus,"disabled",!0),this.#setActiveItem(this.#btnStudeid),this.#showHiddenElement(this.#table,r.getFlipCard()),this.createTable(t.getStudiedWords(),t.getPartSpeech()),this.#flagMode=1)}),Helper.setEvent(this.#btnCard,"click",e=>{2!==this.#flagMode&&(Helper.rmClass(s.getTableSettingsImgTag(),"rotate60"),Helper.addClass(s.getGearBox(),"hide"),s.resetCounter(),s.setChecked(),Helper.addClass(s.getTableSettingsTag(),"hidden"),Helper.rmAttr(this.#eng,"disabled"),Helper.rmAttr(this.#rus,"disabled"),this.#setActiveItem(this.#btnCard),r.resetCounter(),r.setWordToField(t.getArrWords(),t.getPartSpeech(),this.#flagEng),this.#showHiddenElement(r.getFlipCard(),this.#table),this.#flagMode=2)}),Helper.setEvent(this.#btnTable,"click",e=>{3!==this.#flagMode&&(Helper.rmClass(s.getTableSettingsTag(),"hidden"),Helper.setAttr(this.#eng,"disabled",!0),Helper.setAttr(this.#rus,"disabled",!0),this.#setActiveItem(this.#btnTable),this.#showHiddenElement(this.#table,r.getFlipCard()),this.createTable(t.getArrWords(),t.getPartSpeech()),this.#flagMode=3)})}}class TableSettings{#tableSettings;#tableSettingsImg;#showTranslate;#hideTranslate;#gearBox;#i;#translateCells;constructor(){this.#tableSettings=Helper.getSelector("#tableSettings"),this.#tableSettingsImg=Helper.getSelector("#tableSettings img"),this.#showTranslate=Helper.getSelector("#showTranslate"),this.#hideTranslate=Helper.getSelector("#hideTranslate"),this.#gearBox=Helper.getSelector("#tableSettingsBox"),this.#i=0,this.#translateCells=null}getTableSettingsTag(){return this.#tableSettings}getTableSettingsImgTag(){return this.#tableSettingsImg}getGearBox(){return this.#gearBox}resetCounter(){this.#i=0,this.#translateCells=null}setChecked(){this.#showTranslate.checked=!0}init(){Helper.setEvent(this.#tableSettings,"click",e=>{this.#i?(Helper.rmClass(this.#tableSettingsImg,"rotate60"),Helper.rmClass(this.#gearBox,"tableSettingsBoxOpacity1"),Helper.addClass(this.#gearBox,"hide"),this.#i--):(Helper.addClass(this.#tableSettingsImg,"rotate60"),Helper.rmClass(this.#gearBox,"hide"),Helper.addClass(this.#gearBox,"tableSettingsBoxOpacity1"),this.#i++)}),Helper.setEvent(this.#showTranslate,"click",e=>{for(const t of this.#translateCells)Helper.rmClass(t,"textTransperent");this.#translateCells=null}),Helper.setEvent(this.#hideTranslate,"click",e=>{null===this.#translateCells&&(this.#translateCells=Helper.getSelectorAll(".cell__translate"));for(let e=1;e<this.#translateCells.length;e++)Helper.addClass(this.#translateCells[e],"textTransperent")})}}document.addEventListener("DOMContentLoaded",()=>{try{var e=(t,r,s)=>{t.requestWordsFromDB().then(e=>{t.setWords(e),r.resetCounter(),s.isCard(t,r)}).catch(e=>{console.log(e),alert(e.message)})};const t=new Card,r=new Menu,s=new Pages,i=new PortionWords,l=new TopButtons,a=new TableSettings;r.init(l,t),s.init(i,r,t,l,e),i.init(t,r,l,s,e),t.init(r,l,i,s,e),l.init(r,t,a),a.init()}catch(e){console.log(e),alert(e.message)}});