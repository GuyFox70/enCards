class Helper{static createElement(t){return document.createElement(t)}static getText(t){return t.innerHTML}static addText(t,e){t.innerHTML=e}static getInt(t){return parseInt(t)}static getFloat(t){return parseFloat(t)}static toJson(t){return JSON.stringify(t)}static fromJson(t){return JSON.parse(t)}static getSelector(t){return document.querySelector(t)}static getSelectorAll(t){return document.querySelectorAll(t)}static getAttr(t,e){return t.getAttribute(e)}static setAttr(t,e,s){t.setAttribute(e,s)}static rmAttr(t,e){t.removeAttribute(e)}static sendFetch(t,r){return new Promise((e,s)=>{fetch(t,r).then(t=>{if(t.ok)return t.json();s(new Error("Fetch is failed!"))}).then(t=>{t.state?e(t.data):s(new Error("Somethins wrong with response!"))}).catch(s)})}static setEvent(t,e,s){t.addEventListener(e,s)}static rmEvent(t,e,s){t.removeEventListener(e,s)}static addClass(e,t){Array.isArray(t)?t.forEach(t=>e.classList.add(t)):e.classList.add(t)}static rmClass(t,e){t.classList.remove(e)}static hasClass(t,e){return t.classList.contains(e)}}export default Helper;class Menu{#menuItem;#topBtMenu;#menu;#i;#partSpeech;#words;#limit;#skip;#card;constructor(t){this.#menuItem=Helper.getSelectorAll(".menu__item"),this.#topBtMenu=Helper.getSelector("#topBtMenu"),this.#menu=Helper.getSelector("#menu"),this.#partSpeech=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech"),this.#i=0,this.#words=Helper.fromJson(localStorage.getItem("words"))||null,this.#skip=Helper.getInt(localStorage.getItem("skip"))||0,this.#limit=Helper.getInt(localStorage.getItem("limit"))||100,this.#card=t}getSkip(){return this.#skip}getLimit(){return this.#limit}getPartSpeech(){return this.#partSpeech}getWords(){return this.#words}setLimit(t){this.#limit=t}setSkip(t){this.#skip=t}setWords(t){this.#words=t}requestWordsFromDB(){const s=new FormData;return s.set("skip",this.#skip),s.set("limit",this.#limit),s.set("partSpeech",this.#partSpeech),new Promise((t,e)=>{Helper.sendFetch("/getWords",{method:"POST",body:s}).then(t).catch(e)})}#addEventItemsMenu(){for(const t of this.#menuItem)Helper.setEvent(t,"click",()=>{this.#partSpeech!==Helper.getAttr(t,"data-partSpeech")&&(this.#menuItem.forEach(t=>Helper.rmClass(t,"activeTab")),Helper.addClass(t,"activeTab"),this.#partSpeech=Helper.getAttr(t,"data-partSpeech"),Helper.rmAttr(this.#menu,"style"),Helper.rmClass(this.#topBtMenu,"activeItem"),this.#i--,this.requestWordsFromDB().then(t=>{this.#words=t,this.#card.resetCounter(),this.#card.setWordToField(this.#words,this.#partSpeech)}).catch(t=>{console.log(t),alert(t.message)}))})}init(){null===this.#words?this.requestWordsFromDB().then(t=>{this.#words=t,this.#card.setWordToField(this.#words,this.#partSpeech)}).catch(t=>{console.log(t),alert(t.message)}):this.#card.setWordToField(this.#words,this.#partSpeech),this.#addEventItemsMenu(),Helper.setEvent(this.#topBtMenu,"click",()=>{this.#i?(Helper.rmClass(this.#topBtMenu,"activeItem"),Helper.rmAttr(this.#menu,"style"),this.#i--):(Helper.addClass(this.#topBtMenu,"activeItem"),Helper.setAttr(this.#menu,"style","left: 0; transition: left .3s linear;"),this.#i++)})}}class Pages{#totalPage;#currentPage;#amountWords;#p;constructor(){this.#totalPage=Helper.getSelector("#totalPage"),this.#currentPage=Helper.getSelector("#currentPage"),this.#p=0,this.#amountWords={}}calculateAmountPages(t,e){this.#p=Math.round(t/e)}#setPagesField(t){Helper.addText(this.#totalPage,t),Helper.setAttr(this.#totalPage,"data-pages",t)}#getCommonAmountWords(e){const t=new FormData,s=Helper.getAttr(Helper.getSelector(".activeTab"),"data-partSpeech");t.set("partSpeech",s),this.#amountWords[s]?(this.calculateAmountPages(this.#amountWords[s],e),this.#setPagesField(this.#p)):Helper.sendFetch("/getAmount",{method:"POST",body:t}).then(t=>{this.#amountWords[s]=t,this.calculateAmountPages(this.#amountWords[s],e),this.#setPagesField(this.#p)}).catch(t=>{this.#setPagesField(0),console.log(t),alert(t.message)})}#setCaretAtEnd(t){const e=document.getSelection();t=t.firstChild,e.collapse(t,t.length)}init(e,s,r,i){this.#getCommonAmountWords(e.getAmountWords()),Helper.setEvent(this.#currentPage,"click",t=>{Helper.setAttr(t.target,"contenteditable",!0),t.target.focus()}),Helper.setEvent(this.#currentPage,"input",t=>{var t=t.target,e=Helper.getText(t),s=Helper.getInt(Helper.getText(t));if(isNaN(s)&&""!==e)return Helper.addText(t,1),void Helper.setAttr(t,"data-page",1);""!==e&&((e=Helper.getInt(Helper.getAttr(this.#totalPage,"data-pages")))<s?(Helper.addText(t,e),Helper.setAttr(t,"data-page",e)):s<1?(Helper.addText(t,1),Helper.setAttr(t,"data-page",1)):(Helper.addText(t,s),Helper.setAttr(t,"data-page",s)),this.#setCaretAtEnd(this.#currentPage))}),Helper.setEvent(this.#currentPage,"blur",t=>{t=Helper.getInt(Helper.getAttr(t.target,"data-page"))-1,t=Helper.getInt(e.getAmountWords())*t;s.setSkip(t),s.requestWordsFromDB().then(t=>{s.setWords(t),e.isCard(r,s,i)}).catch(t=>{console.log(t),alert(t.message)})})}}class AmountWords{#amountField;#nextAmount;#prevAmount;#step;#maxAmount;#minAmount;#amount;#maxAmountPages;#minAmountPages;constructor(){this.#amountField=Helper.getSelector("#amountField"),this.#nextAmount=Helper.getSelector("#nextAmount"),this.#prevAmount=Helper.getSelector("#prevAmount"),this.#step=10,this.#maxAmount=100,this.#minAmount=10,this.#amount=Helper.getInt(localStorage.getItem("limit"))||this.#maxAmount,this.#maxAmountPages=1,this.#minAmountPages=1}getAmountWords(){return this.#amount}#checkLimit(t){t<=this.#minAmount?(this.#amount=this.#minAmount,this.#prevAmount.disabled=!0):t>=this.#maxAmount?(this.#amount=this.#maxAmount,this.#nextAmount.disabled=!0):(Helper.rmAttr(this.#prevAmount,"disabled"),Helper.rmAttr(this.#nextAmount,"disabled")),Helper.setAttr(this.#amountField,"data-value",this.#amount),Helper.addText(this.#amountField,this.#amount)}isCard(t,e,s){Helper.hasClass(t.getFlipCard(),"hidden")?s.createTable(e.getWords(),e.getPartSpeech()):(t.resetCounter(),t.setWordToField(e.getWords(),e.getPartSpeech()))}init(e,s,r){this.#checkLimit(this.#amount),Helper.addText(this.#amountField,this.#amount),Helper.setAttr(this.#amountField,"data-value",this.#amount),Helper.setEvent(this.#nextAmount,"click",()=>{this.#amount=this.#amount+this.#step,this.#checkLimit(this.#amount),s.setLimit(this.#amount),s.requestWordsFromDB().then(t=>{s.setWords(t),this.isCard(e,s,r)}).catch(t=>{console.log(t),alert(t.message)})}),Helper.setEvent(this.#prevAmount,"click",()=>{this.#amount=this.#amount-this.#step,this.#checkLimit(this.#amount),s.setLimit(this.#amount),s.requestWordsFromDB().then(t=>{s.setWords(t),this.isCard(e,s,r)}).catch(t=>{console.log(t),alert(t.message)})})}}class Card{#flipCard;#flipCardInner;#eng;#mistakeReport;#btnsendReport;#btnCancelReport;#btnPrev;#btnKnow;#btnNext;#i;#j;#wordField;#translateField;constructor(){this.#flipCard=Helper.getSelector("#flipCard"),this.#eng=Helper.getSelector("#eng"),this.#mistakeReport=Helper.getSelector("#mistakeReport"),this.#btnsendReport=Helper.getSelector("#sendReport"),this.#btnCancelReport=Helper.getSelector("#cancelReport"),this.#btnPrev=Helper.getSelector("#prevWord"),this.#btnKnow=Helper.getSelector("#knowWord"),this.#btnNext=Helper.getSelector("#nextWord"),this.#wordField=Helper.getSelector("#wordField"),this.#translateField=Helper.getSelector("#translateField"),this.#flipCardInner=Helper.getSelector("#flipCardInner"),this.#i=0,this.#j=0}getFlipCard(){return this.#flipCard}getWordField(){return this.#wordField}getTranslateField(){return this.#translateField}resetCounter(){this.#i=0}setWordToField(t,e){setTimeout(()=>{null===t||0===t.length?(alert("Empty"),Helper.addText(this.#wordField,"Example"),Helper.addText(this.#translateField,"Пример")):(Helper.addText(this.#wordField,t[this.#i].word),Helper.addText(this.#translateField,t[this.#i].translate[e].join(", ")))},0)}init(e){Helper.setEvent(this.#flipCard,"click",t=>{this.#j?(Helper.rmClass(this.#flipCardInner,"flip-card__inner-back"),this.#j--):(Helper.addClass(this.#flipCardInner,"flip-card__inner-back"),this.#j++)}),Helper.setEvent(this.#btnPrev,"click",t=>{t.stopPropagation(),this.#i--,this.#i<0&&(this.#i=e.getLimit()-1),this.setWordToField(e.getWords(),e.getPartSpeech())}),Helper.setEvent(this.#btnKnow,"click",t=>{t.stopPropagation(),console.log("push")}),Helper.setEvent(this.#btnNext,"click",t=>{t.stopPropagation(),this.#i++,this.#i>=e.getLimit()&&(this.#i=0),this.setWordToField(e.getWords(),e.getPartSpeech())})}}class TopButtons{#btnStudeid;TopButtons;#btnCard;#btnTable;#activeItem;#table;#tbody;constructor(){this.#btnStudeid=Helper.getSelector("#btnStudeid"),this.#btnCard=Helper.getSelector("#btnCard"),this.#btnTable=Helper.getSelector("#btnTable"),this.#activeItem=this.#btnCard,this.#table=Helper.getSelector("#table"),this.#tbody=Helper.getSelector("#table .table__tbody")}#rmActive(){Helper.rmClass(this.#activeItem,"activeItem")}createTable(e,s){if(Helper.addText(this.#tbody,""),null!==e&&0!==e.length&&!Helper.hasClass(this.#table,"hidden")){this.#rmActive(),Helper.addClass(this.#btnTable,"activeItem");for(let t=0;t<e.length;t++){const i=e[t],a=Helper.createElement("div");Helper.addClass(a,"table__tr");var r=Helper.createElement("td"),r=(Helper.addClass(r,["table__td","cell__number"]),Helper.addText(r,t+1),a.appendChild(r),Helper.createElement("td")),r=(Helper.addClass(r,["table__td","cell__word"]),Helper.addText(r,i.word),a.appendChild(r),Helper.createElement("td")),r=(Helper.addClass(r,["table__td","cell__transcription"]),Helper.addText(r,i.transcription),a.appendChild(r),Helper.createElement("td"));Helper.addClass(r,["table__td","cell__translate"]),Helper.addText(r,i.translate[s].join(", ")),a.appendChild(r),this.#tbody.appendChild(a)}this.#activeItem=this.#btnTable}}init(e,s){Helper.setEvent(this.#btnStudeid,"click",t=>{Helper.hasClass(this.#btnStudeid,"activeItem")||(this.#rmActive(),Helper.addClass(this.#btnStudeid,"activeItem"),this.#activeItem=this.#btnStudeid)}),Helper.setEvent(this.#btnCard,"click",t=>{Helper.hasClass(this.#btnCard,"activeItem")||(this.#rmActive(),Helper.addClass(this.#btnCard,"activeItem"),s.resetCounter(),s.setWordToField(e.getWords(),e.getPartSpeech()),Helper.addClass(this.#table,"hidden"),Helper.rmClass(s.getFlipCard(),"hidden"),this.#activeItem=this.#btnCard)}),Helper.setEvent(this.#btnTable,"click",t=>{Helper.hasClass(this.#btnTable,"activeItem")||(Helper.addClass(s.getFlipCard(),"hidden"),Helper.rmClass(this.#table,"hidden"),this.createTable(e.getWords(),e.getPartSpeech()))})}}document.addEventListener("DOMContentLoaded",()=>{try{const t=new Card,e=new Menu(t),s=new Pages,r=new AmountWords,i=new TopButtons;e.init(),s.init(r,e,t,i),r.init(t,e,i),t.init(e),i.init(e,t)}catch(t){console.log(t),alert(t.message)}});